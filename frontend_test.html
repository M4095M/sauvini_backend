<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sauvini Frontend Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 4px;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Sauvini Frontend Test</h1>
    <p>Test your frontend integration with the Django backend</p>

    <div class="form-group">
      <label>API Base URL:</label>
      <input
        type="text"
        id="apiUrl"
        value="http://localhost:4000/api/v1"
        readonly
      />
    </div>

    <h2>üîê Authentication Test</h2>

    <h3>Student Registration</h3>
    <form id="studentRegisterForm">
      <div class="form-group">
        <label>First Name:</label>
        <input type="text" id="firstName" value="Test" required />
      </div>
      <div class="form-group">
        <label>Last Name:</label>
        <input type="text" id="lastName" value="Student" required />
      </div>
      <div class="form-group">
        <label>Email:</label>
        <input
          type="email"
          id="email"
          value="test.student@example.com"
          required
        />
      </div>
      <div class="form-group">
        <label>Wilaya:</label>
        <input type="text" id="wilaya" value="Algiers" required />
      </div>
      <div class="form-group">
        <label>Phone Number:</label>
        <input type="text" id="phone" value="0555123456" required />
      </div>
      <div class="form-group">
        <label>Academic Stream:</label>
        <select id="academicStream" required>
          <option value="Mathematics">Mathematics</option>
          <option value="Experimental Sciences">Experimental Sciences</option>
          <option value="Literature">Literature</option>
          <option value="Math-Technique">Math-Technique</option>
        </select>
      </div>
      <div class="form-group">
        <label>Password:</label>
        <input type="password" id="password" value="testpassword123" required />
      </div>
      <button type="submit">Register Student</button>
    </form>

    <h3>Student Login</h3>
    <form id="studentLoginForm">
      <div class="form-group">
        <label>Email:</label>
        <input
          type="email"
          id="loginEmail"
          value="test.student@example.com"
          required
        />
      </div>
      <div class="form-group">
        <label>Password:</label>
        <input
          type="password"
          id="loginPassword"
          value="testpassword123"
          required
        />
      </div>
      <button type="submit">Login Student</button>
    </form>

    <h3>Admin Login</h3>
    <form id="adminLoginForm">
      <div class="form-group">
        <label>Email:</label>
        <input
          type="email"
          id="adminEmail"
          value="frihaouimohamed@gmail.com"
          required
        />
      </div>
      <div class="form-group">
        <label>Password:</label>
        <input type="password" id="adminPassword" value="07vk640xz" required />
      </div>
      <button type="submit">Login Admin</button>
    </form>

    <div id="result" class="result" style="display: none"></div>

    <script>
      const API_BASE_URL = "http://localhost:4000/api/v1";
      let currentToken = null;

      function showResult(message, isError = false) {
        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";
        resultDiv.className = `result ${isError ? "error" : "success"}`;
        resultDiv.innerHTML = `<pre>${JSON.stringify(message, null, 2)}</pre>`;
      }

      // Student Registration
      document
        .getElementById("studentRegisterForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const response = await fetch(
              `${API_BASE_URL}/auth/student/register`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  first_name: document.getElementById("firstName").value,
                  last_name: document.getElementById("lastName").value,
                  email: document.getElementById("email").value,
                  wilaya: document.getElementById("wilaya").value,
                  phone_number: document.getElementById("phone").value,
                  academic_stream:
                    document.getElementById("academicStream").value,
                  password: document.getElementById("password").value,
                  password_confirm: document.getElementById("password").value,
                }),
              }
            );
            const data = await response.json();
            showResult(data, !response.ok);
          } catch (error) {
            showResult({ error: error.message }, true);
          }
        });

      // Student Login
      document
        .getElementById("studentLoginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const response = await fetch(`${API_BASE_URL}/auth/student/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email: document.getElementById("loginEmail").value,
                password: document.getElementById("loginPassword").value,
                user_type: "student",
              }),
            });
            const data = await response.json();
            if (data.access_token) {
              currentToken = data.access_token;
              showResult({
                message: "Login successful! Token saved.",
                user: data.user,
              });
            } else {
              showResult(data, true);
            }
          } catch (error) {
            showResult({ error: error.message }, true);
          }
        });

      // Admin Login
      document
        .getElementById("adminLoginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const response = await fetch(`${API_BASE_URL}/auth/admin/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email: document.getElementById("adminEmail").value,
                password: document.getElementById("adminPassword").value,
                user_type: "admin",
              }),
            });
            const data = await response.json();
            if (data.access_token) {
              currentToken = data.access_token;
              showResult({
                message: "Admin login successful! Token saved.",
                user: data.user,
              });
            } else {
              showResult(data, true);
            }
          } catch (error) {
            showResult({ error: error.message }, true);
          }
        });

      // Test protected endpoint
      window.testProtectedEndpoint = async () => {
        if (!currentToken) {
          showResult({ error: "Please login first to get a token" }, true);
          return;
        }
        try {
          const response = await fetch(
            `${API_BASE_URL}/auth/admin/all-professors`,
            {
              headers: {
                Authorization: `Bearer ${currentToken}`,
                "Content-Type": "application/json",
              },
            }
          );
          const data = await response.json();
          showResult(data, !response.ok);
        } catch (error) {
          showResult({ error: error.message }, true);
        }
      };

      // Add test button
      document.body.innerHTML += `
            <h3>üîí Test Protected Endpoint</h3>
            <button onclick="testProtectedEndpoint()">Test Admin Endpoint (requires login)</button>
        `;
    </script>
  </body>
</html>
